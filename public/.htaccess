RewriteEngine On

# üåê –†–µ–¥–∏—Ä–µ–∫—Ç www ‚Üí –±–µ–∑ www (301)
RewriteCond %{HTTP_HOST} ^www\.aquanika74\.ru$ [NC]
RewriteRule ^(.*)$ https://aquanika74.ru/$1 [R=301,L]

# üö´ –ó–ê–ü–†–ï–¢ –ù–ê –ü–†–Ø–ú–û–ô –î–û–°–¢–£–ü –ö –§–†–ê–ì–ú–ï–ù–¢–ê–ú –î–õ–Ø –í–°–ï–•
RewriteCond %{REQUEST_URI} ^/fragments/ [NC]
RewriteCond %{HTTP:X-Requested-With} !=XMLHttpRequest
RewriteRule ^fragments/.*$ - [F,L]

# üö´ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: robots noindex –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
<IfModule mod_headers.c>
    <FilesMatch "fragments/.*\.html$">
        Header set X-Robots-Tag "noindex, nofollow, noarchive"
    </FilesMatch>
</IfModule>

# üìÅ –ï—Å–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π –ø—É—Ç—å ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª/–ø–∞–ø–∫–∞, –æ—Ç–¥–∞—Ç—å –∫–∞–∫ –µ—Å—Ç—å
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# üñº –ï—Å–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—É—Ä—Å, –Ω–æ –µ–≥–æ –Ω–µ—Ç ‚Üí 404
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|ico|pdf|txt|svg|woff|woff2|ttf|eot|webp|mp4|xml|json)$ [NC]
RewriteRule ^ - [R=404,L]

# üè† SPA FALLBACK: –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ‚Üí index.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /index.html [L]

# üîê –ë–ï–ó–û–ü–ê–°–ù–´–ï –ó–ê–ì–û–õ–û–í–ö–ò (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
<IfModule mod_headers.c>
    # –ë–∞–∑–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # –£–ø—Ä–æ—â–∞–µ–º COOP/COEP –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏
    Header always set Cross-Origin-Opener-Policy "same-origin-allow-popups"
    
    # Content Security Policy —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º data: –¥–ª—è Vite
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://mc.yandex.ru https://mc.yandex.com https://yastatic.net; style-src 'self' 'unsafe-inline' data: https://yastatic.net; img-src 'self' data: https: blob: https://mc.yandex.ru https://mc.yandex.com; connect-src 'self' https://formspree.io https://api-maps.yandex.ru https://mc.yandex.ru https://mc.yandex.com wss://mc.yandex.ru wss://mc.yandex.com; font-src 'self' data: https://yastatic.net; frame-src 'self' https://mc.yandex.ru https://mc.yandex.com; base-uri 'self'; form-action 'self' https://formspree.io;"
</IfModule>

# ‚è± –ö–≠–®–ò–†–û–í–ê–ù–ò–ï
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 month"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType application/json "access plus 1 day"
</IfModule>

# üì¶ –°–ñ–ê–¢–ò–ï
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
    AddOutputFilterByType DEFLATE application/xml application/xhtml+xml application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript application/x-javascript
    AddOutputFilterByType DEFLATE application/json image/svg+xml
</IfModule>